# Terraform AWS Infrastructure

This repository contains Terraform code for provisioning AWS infrastructure, including VPC, RDS, EC2, ALB, CloudTrail, Bastion Host, and WAF resources. The setup is modular, making use of reusable Terraform modules for each major component.

## Repository Structure

- `main.tf` - The main entrypoint that ties together all modules and resources.
- `variables.tf` - Input variables for configuring the infrastructure.
- `outputs.tf` - Output values from the Terraform deployment.
- `user_data.sh` - Shell script used for EC2 user data (installs Apache, PHP, and sets up a sample web page).
- `.terraform.lock.hcl` - Terraform dependency lock file.
- `modules/` - Contains submodules for VPC, RDS, EC2, ALB, Bastion Host, CloudTrail, and WAF.

## Main Components

### Providers

- Uses AWS provider (configured for `ap-northeast-2` region and `terraform-user` profile).

### Modules

- **VPC**: Sets up public/private subnets, security groups.
- **RDS**: Provisions a MySQL 8.0.34 instance with fixed credentials (should be changed for production).
- **EC2**: Deploys an Auto Scaling Group with desired capacity, using a user data script for initial setup.
- **ALB**: Application Load Balancer with listeners and target groups.
- **CloudTrail**: Enables CloudTrail, S3 bucket for logs, CloudWatch integration, and GuardDuty.
- **Bastion Host**: Sets up a jumpbox in the public subnet, with SSH key generation and local file storage.
- **WAF**: Web Application Firewall attached to the ALB.
- **Route53**: (Commented out in main.tf, can be enabled for DNS setup.)

## Example Usage

To deploy this infrastructure:

```sh
terraform init
terraform plan
terraform apply
```

### EC2 User Data

The `user_data.sh` script installs Apache, PHP, and configures a welcome page:
```sh
#!/bin/bash
sudo apt update -y
sudo apt install -y apache2 php libapache2-mod-php curl unzip
sudo systemctl enable apache2
sudo systemctl start apache2
echo "<h1>Welcome to Apache Web Server</h1>" > /var/www/html/index.html
```

## Variables

Input variables are defined in `variables.tf` and within each module (see `modules/*/variables.tf`). Customize these to fit your AWS environment and requirements.

## Outputs

Key output values such as ALB DNS name, VPC IDs, and resource ARNs are exported for integration and reference.

## Notes

- This setup is for demonstration and learning. **Do not use hardcoded credentials in production.**
- Modules are designed for extensibility; feel free to adapt them to your needs.

## License

Add your preferred license.

---

*Generated by Copilot based on repository source code and structure.*
